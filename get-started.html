<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8" />
<title>Get Started - An File Server for D2 developers</title>
<meta name="description" content="D2Server入门初级中文教程，从下载D2Server开始，一步一步教你如何使用D2Server管理前端项目" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="me" href="https://plus.google.com/102678188433989978435?rel=author" />
<link rel="stylesheet" type="text/css" href="/common/bootstrap/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/node-d2server/css/base.min.css" />
<script type="text/javascript" src="/common/jquery/jquery.min.js"></script>
</head>

<body>
<div class="navbar navbar-inverse navbar-fixed-top eC">
	<div class="container">
		<a href="/node-d2server/index.html" class="navbar-brand">D2Server</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".eD">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</button>
		<div class="nav-collapse collapse eD">
			<ul class="nav navbar-nav">
				<li class="active">
					<a href="/node-d2server/get-started.html">Get Started</a>
				</li>
				<li>
					<a href="/node-d2server/module.html">Module</a>
				</li>
				<li>
					<a href="/node-d2server/download.html">Download</a>
				</li>
				<li>
					<a href="/node-d2server/feedback.html">Feedback</a>
				</li>
			</ul>
		</div>
	</div>
</div>
<div class="container">





<!-- Content Begin -->
<div class="row">
	<div class="col-lg-3">
		<div class="bs-sidebar affix">
			<ul class="nav bs-sidenav">
				<li class="active">
					<a href="#overview">前期准备</a>
					<ul class="nav">
						<li>
							<a href="#os">系统环境及配置</a>
						</li>
						<li>
							<a href="#download">下载源码</a>
						</li>
						<li>
							<a href="#module">安装组件</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="#confg">配置客户端</a>
				</li>
				<li>
					<a href="#run">运行客户端</a>
				</li>
				<li>
					<a href="#project">项目管理</a>
					<ul class="nav">
						<li>
							<a href="#init">初始化</a>
						</li>
						<li>
							<a href="#edit">配置项目</a>
						</li>
						<li>
							<a href="#visite">访问目录</a>
						</li>
						<li>
							<a href="#export">导出项目</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="#finish">完成</a>
				</li>
			</ul>
		</div>
	</div>
	<div class="col-lg-9">
		<!-- Overview：begin -->
		<div class="bs-docs-section">
			<div class="page-header">
				<h1 id="overview">前期准备</h1>
			</div>
			<p class="lead">
				D2Server运行的基础是在客户端搭建的服务器环境，所以首先我们要先下载安装搭建Server环境。这是一劳永逸的过程，搭建好之后，你就不需要再关注Server的配置，而将所有的精力投在项目上。让D2Server在后台为你默默助力吧。
			</p>
			<hr>
			<p>
				D2Server 3.0之后，使用NodeJS重写了所有模块。得益于NodeJS的模块化管理以及NodeJS社区的繁荣，相比于之前的<a href="https://github.com/Bacra/php-d2server" target="_blank">PHP版</a>在环境配置方面，得到了许多<a href="https://github.com/Bacra/php-d2server#get-started" target="_blank">简化</a>。
			</p>
			<hr>

			<!-- 系统环境及配置：begin -->
			<h3 id="os">系统环境及配置</h3>
			<p>
				D2Server运行需要<a href="http://nodejs.org/" target="_blank">NodeJS</a>环境，其中压缩JS和CSS过程需要<a href="http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html" target="_blank">JAVA</a>环境。
			</p>
			<p>
				windows用户安装过程中，还需<a href="http://www.microsoft.com/visualstudio/eng/downloads#d-2010-express" target="_blank">Visual Studio</a>对<code>socket.io-client</code>组建的源码编译（安装学习版即可），详情见<a href="#module">安装组件</a>。
			</p>
			<hr>
			<p>
				后台挂靠D2Server，占用内存一般在100-150MB左右，2G内存的电脑跑着无压力。对系统其他资源需求很少，可忽略。
			</p>
			<!-- 系统环境及配置：end -->

			<hr>
			<!-- 下载源码：begin -->
			<h3 id="download">下载源码</h3>
			<p class="lead">你可以很方便地从Github上下载项目源码，<code>master</code>分支上保存着最新版的D2Server，<code>dev</code>分支则汇集着正在开发的新功能。</p>
<hr>
<h4>通过Git Clone（推荐）</h4>
<p>
	推荐使用git进行项目的安装，方便以后的版本迭代更新。
</p>
<div class="highlight">
<pre><code class="prettyprint">git clone https://github.com/Bacra/node-d2server</code></pre>
</div>
<hr>
<h4>直接下载</h4>
<p>
	通过<a href="https://github.com/Bacra/node-d2server/archive/master.zip" target="_blank">master zip</a>或则<a href="https://github.com/Bacra/node-d2server/releases" target="_blank">Releases</a>，可直接将项目打包成zip下载到本地。
</p>
			<!-- 下载源码：end -->
			
			<hr>
			<!-- 安装组建：begin -->
			<h3 id="module">安装组件</h3>
			<p>
				D2Server所需的组件，可以通过<code>npm</code>一键安装。
			</p>
			<p>
				请确保已经安装NodeJS环境，并且已经将<code>node</code>和<code>npm</code>放入<code>path</code>目录。
			</p>
			<div class="highlight">
<pre><code class="prettyprint">cd node-d2server
npm install</code></pre>
			</div>
			<hr>
			<h5>补充信息</h5>
			<ul>
				<li>
					<p>
						window用户在运行<code>npm install</code>前，请务必确保已经安装<a href="http://www.microsoft.com/visualstudio/eng/downloads#d-2010-express" target="_blank">Visual Studio</a>。
					</p>
					<p>
						如果实在不想安装这个巨无霸，可以尝试下载已编译好的<a href="https://github.com/Bacra/node-d2server/releases/download/v3.2.3/socket.io-windows.zip" taget="_blank">socket.io</a>（win7下编译），解压到<code>/node_modules/socket.io/</code>。可通过浏览器自动刷新功能来判断socket是否生效。
					</p>
				</li>
				<li>
					<p>
						不用理会中途的warn信息，即使中途有源码编译失败，也不会影响到使用（可能有特例，欢迎<a href="/node-d2server/feedback.html" target="_blank">反馈</a>）
					</p>
				</li>
				<li>
					<p>
						如果<code>yuicompressor</code>安装失败，尝试修改<a href="https://github.com/Bacra/node-d2server/blob/master/package.json" target="_blank">package.json</a>，将<code>yuicompressor</code>版本号修改为<b>2.4.8</b>；或下载<a href="https://github.com/Bacra/node-d2server/releases/download/v3.2.3/yuicompressor-2.4.7.zip" taget="_blank">yuicompressor 2.4.7</a>，解压到<code>/node_modules/yuicompressor/</code>。
					</p>
				</li>
			</ul>
			<!-- 安装组件：end -->
		</div>
		<!-- Overview：end -->


		<!-- 配置客户端：begin -->
		<div class="bs-docs-section">
			<div class="page-header">
				<h1 id="confg">配置客户端</h1>
			</div>
			<p>
				复制D2Server根目录下的<a href="https://github.com/Bacra/node-d2server/blob/master//conf.js" target="_blank">conf.js.example</a>，新的文件名为<code>conf.js</code>。打开编辑<code>conf.js</code>文件，可以配置的属性如下：
			</p>
			<div class="highlight">
<pre><code class="prettyprint">var SourcePath = ".source/";

module.exports = {
	'DocumentRoot': __dirname + '/wwwroot/',			// 所有项目所在根目录
	'Domain': 'test.com',						// 绑定的顶级域名
	'SourcePath': SourcePath,					// 项目开发文件存放文件夹
	'MainConfigFile': SourcePath + 'ProjConf.js',			// 项目主体配置文件
	'ProjConfigFile': SourcePath + 'wf_ProjConf.js',		// 项目成员各自的配置文件
	'DynamicDataPath': SourcePath + '.data/',			// 存放动态数据的目录
	'DynamicDataFile': SourcePath + '.data/.fileinfo',		// 存放动态数据的配置方案
	'StyleMapFile': SourcePath+'.stylemap',				// 存放样式解析后的映射关系
	'DevServPort': 82,				// 开发服务器端口
	'InfoServPort': 81,				// 信息服务器端口
	'ViewServPort': 80,				// 静态文件浏览服务器端口
	'SpliceServPort': 83,				// 文件拼接服务器端口
	'AutoClearCache': 20*60*1000,		// 自动清除缓存的定时器
	'MaxCacheFileSize': 2*1024*1024*8,	// 缓存中单个文件最大体积
	'EJS_openTag': '&lt;%',		// EJS 开始标签
	'EJS_closeTag': '%&gt;'		// EJS 结束标签
};</code></pre>
			</div>
			<p>
				如果你正在或则准备开展团队协作工作，那么<strong>你必须修改<code>ProjConfigFile</code>属性，将它修改成你自己的配置文件名。</strong>
			</p>
			<p>
				配置中，和以后工作息息相关的是<code>MainConfigFile</code>和<code>ProjConfigFile</code>。以后页面开放都会围绕着这两个项目配置文件展开。
			</p>
			<p>
				需要注意一下几个port参数，查看这些端口是否已经被占用（尤其是<code>ViewServPort</code>的80端口）。
			</p>
			<p>
				PS：不推荐修改除<code>DocumentRoot</code>之外的目录结构，除非你在工作中遇到了困难（注意和团队其他成员协调好）
			</p>
		</div>
		<!-- 配置客户端：end -->

		<!-- 运行客户端：begin -->
		<div class="bs-docs-section">
			<div class="page-header">
				<h1 id="run">运行客户端</h1>
			</div>
			<p>
				启动D2Server的入口是<code>serv.js</code>，直接用NodeJS调用即可
			</p>
			<div class="highlight">
<pre><code class="prettyprint">cd node-d2server
node serv.js</code></pre>
			</div>
			<p>
				之后就是一些运行状况的输出，如下图
			</p>
			<p>
				<img width="641" height="238" src="/node-d2server/images/start.png" alt="D2Server Start" />
			</p>
			<p>
				一般不出现黄色或则红色标注的信息，Server就可以判定为运行正常。
			</p>
			<p>
				<strong>Server启动之后，不要关闭终端；在关闭当前Server前，也不要重复启动Server</strong>
			</p>
		</div>
		<!-- 运行客户端：end -->

		<!-- 项目管理：begin -->
		<div class="bs-docs-section">
			<div class="page-header">
				<h1 id="project">项目管理</h1>
			</div>
			<p class="lead">
				对于我们还是D2Server，项目都是最核心的部分。D2Server从项目创建开始，到最后的工作交接，每一步都力求最大化节约中间时间，协助你处理琐碎的日常工作。
			</p>

			<!-- 初始化：begin -->
			<h3 id="init">初始化</h3>
			<p>
				当前，我们还没项目可以用来做测试。
			</p>
			<p>
				创建项目最简单的方法是在D2Server启动后终端cmd中运行<code>init</code>命令。
			</p>
			<div class="highlight">
				<pre><code class="prettyprint">init &lt;%projectName%&gt; [配置方案(可选)]</code></pre>
			</div>
			<p>
				运行<code>init</code>命令之后，会出现一个确认提示<code>yes</code>即可。
			</p>
			<p>
				之后D2Server会自动在<code>DocumentRoot</code>目录下创建一个以<code>&lt;%projectName%&gt;</code>命名的文件夹，并创建项目的配置文件<code>MainConfigFile</code>及其他相关文件。
			</p>
			<p>
				同时，终端中也会显示已读取到项目配置信息，完成初始化工作的信息
			</p>
			<hr>
			<h4>配置方案是什么？</h4>
			<p>
				在D2Server根目录下的<a href="https://github.com/Bacra/node-d2server/blob/master/template" target="_blank">template</a>文件夹下，保存着项目初始化的配置方案，默认有两个<code>default</code>和<code>simple</code>。
			</p>
			<p>
				你可以在该目录下创建文件夹和相应的目录结构及文件，<strong>重启D2Server</strong>。然后在<code>init</code>命令中指明配置方案（文件夹名），那么D2Server会自动将该文件夹下的文件复制到新的项目中。
			</p>
			<p>
				<b>注意：</b>创建配置方案的时候，不要忘了创建项目主体配置文件<code>MainConfigFile</code>噢
			</p>
			<!-- 初始化：end -->


			<!-- 配置项目：begin -->
			<hr>
			<h3 id="edit">配置项目</h3>
			<p>
				打开具体项目的<code>.source/ProjConf.js</code>文件，你就可以查看这个项目的配置情况了。
			</p>
			<div class="highlight">
<pre><code class="prettyprint">module.exports = {
	"name": "d2server",					// 项目名称
	"alias": 'd2server',					// 项目的默认二级域名
	"sync": 'c:/svn/d2server/',				// fileMap文件同步目录
	"catalog": 'node-d2server/',				// 项目内嵌的二级目录
	"baseLess": "common/b.less",				// less公共文件
	"MinCssName": false,					// 压缩样式名的前缀
	"hostname": false,					// 线上资源域名
	"defaultHeader": "common/header.html",			// 公共头部
	"defaultFooter": "common/footer.html",			// 公共尾部
	"extra": ["wf_ProjConf.js"],				// 子配置文件
	"dataAPI": false,					// 动态数据接口
	"HTML": {						// 配置项目HTML（公共部分）
		"index/index.html": {
			'index.html': {
				'footer': false,
				'title': 'D2Server'
			}
		}
	},
	"fileMap": {						// 配置文件映射（公共部分）
		"css/base.min.css": [
			'common/bootstrap-doc.css',
			'common/nav.less',
			'common/frame.less',

			"index/index.less"
		],

		"js/base.min.js": [
			'common/nav.js',
			'common/nav.test.js',
			'common/frame.js',
			'common/frame.test.js',

			"index/index.js",
			"index/index.test.js"
		]
	}
};</code></pre>
			</div>
			<p>
				配置文件中，改动比较多的，是<code>HTML</code>和<code>fileMap</code>属性。其他属性一般只在项目初始化的时候修改，之后团队协作的话，最好不好修改；有修改依旧协商解决（至少要告知其他人）。
			</p>
			<h4><code>HTML</code>属性</h4>
			<p>
				<b>值结构：</b>相对于<code>SourePath</code>目录的开发文件路径 => 相对于项目根目录的导出文件路径 => 导出文件的相关属性配置。
			</p>
			<p>
				<strong><code>HTML</code>配置是将一个HTML文件，通过不同的参数配置，拆分成独立的文件，同时给每个新的HTML文件声明一个访问地址。</strong>
			</p>
			<div class="highlight">
<pre><code class="prettyprint">{
	"HTML": {
		"index/index.html": {			// 该路径相对于.source目录，是开发文件的路径
			'index.html': {			// 该路径相对于项目根目录，是导出文件（浏览器访问）路径
				'footer': false,	// 一些配置属性
				'title': 'D2Server',
				'block': 'index'
			},
			'somepage.html': {
				'title': 'xxxx',
				'block': 'some'
			}
		}
	}
}</code></pre>
		</div>
		<h4><code>fileMap</code>属性</h4>
		<p>
			<b>值结构：</b>相对于项目根目录的导出文件路径 => 相对于<code>SourePath</code>目录的开发文件路径。
		</p>
		<p>
			<strong><code>fileMap</code>配置是将各个资源文件合并成一个文件，同时声明一个新的访问地址。</strong>
		</p>
		<div class="highlight">
<pre><code class="prettyprint">{
	"fileMap": {
	"css/base.min.css": [			// 该路径相对于项目根目录，是导出文件（浏览器访问）路径
		'common/bootstrap-doc.css',	// 该路径相对于.source目录，是开发文件的路径
		'common/nav.less',		// 配置在这个数组里面的文件，在项目导出的时候，会自动合并
		'common/frame.less',

		"index/index.less"
	],

	"js/base.min.js": [
		'common/nav.js',
		'common/nav.test.js',
		'common/frame.js',
		'common/frame.test.js',

		"index/index.js",
		"index/index.test.js"
	]
	}
}</code></pre>
		</div>
		<hr>
		<h5>补充信息</h5>
		<ul>
			<li>
				如果有定义<code>extra</code>参数，那么完整的<code>HTML</code> <code>fileMap</code>以及<code>MinCssName</code>配置信息，还要参考附加的子配置文件
			</li>
			<li>
				如果创建了<code>ProjConfigFile</code>，那么<code>sync</code> <code>alias</code>的值，以<code>ProjConfigFile</code>配置文件中的属性为准
			</li>
			<li>
				该开发文档本身就是基于D2Server开发的，你可以从<a href="https://github.com/Bacra/node-d2server/archive/gh-pages.zip" target="_blank">这里</a>下载到这个项目
			</li>
		</ul>
		
		<!-- 配置项目：end -->

		<!-- 访问目录：begin -->
		<hr>
		<h3 id="visite">访问目录</h3>
		<p>
			查看创建项目的文件夹，你会发现文件夹根目录空空如也。但你却可以通过下面的方式访问到<code>index.html</code>文件，是不是很神奇。
		</p>
		<ul>
			<li>
				<p>
					浏览器中访问<code>http://test.com:82/&lt;%projectName%&gt;/index.html</code>，即可打开项目的初始化页面。
				</p>
			</li>
			<li>
				<p>
					也可以在系统host添加 <code>127.0.0.1 &lt;%projectName%&gt;.test.com</code>
				</p>
				<p>
					然后在浏览器中访问<code>http://&lt;%projectName%&gt;.test.com:82/index.html</code>。
				</p>
			</li>
		</ul>
		<hr>
		<h5>你可能感兴趣的事</h5>
		<ul>
			<li>
				在浏览器中使用键盘快捷键<code>`</code>，即可打开项目配置<code>HTML</code>页面列表，实现浏览器中快速切换项目页面
			</li>
			<li>
				打开<b>真实被引用的</b>资源文件，编辑内容然后保存，浏览器的页面内容也会自动刷新
			</li>
		</ul>
		<!-- 访问目录：end -->


		<!-- 导出项目：begin -->
		<hr>
		<h3 id="export">导出项目</h3>
		<p>
			代码码了一天，想转给后端同事的时候却发现，项目目录依然如初始化的时候空空如也。总不能把<code>.source</code>文件夹丢给后端的同事，“你们自己合一下，我下班了”。
		</p>
		<p>
			那该怎么办呢？<code>export</code>命令来帮你。
		</p>
		<p>
			在D2Server启动后终端cmd中运行<code>export</code>命令。
		</p>
		<div class="highlight">
			<pre><code class="prettyprint">export &lt;%projectName%&gt;</code></pre>
		</div>
		<p>
			待终端显示“Everything is done”，你进项目文件夹看看，是不是所需要的文件都自动合并好了。
		</p>
		<hr>
		<h5>你可能感兴趣的事</h5>
		<ul>
			<li>
				给项目设置<code>sync</code>同步路径，导出文件的同时，定义在<code>fileMap</code>中的文件，也会自动同步到目标文件夹
			</li>
			<li>
				<code>fileMap</code>中，资源文件名以<code>.test</code>结尾（不包含文件拓展名）的文件，不会合并到最终文件中
			</li>
		</ul>
		<!-- 导出项目：end -->
	</div>
	<!-- 项目管理：end -->

	<!-- 结束语：begin -->
	<div class="bs-docs-section">
		<div class="page-header">
			<h1 id="finish">结束语</h1>
		</div>
		<p class="lead">
			恭喜你，完成了D2Server的客户端配置，现在你可以利用D2Server为你的项目助力了。
		</p>
		<p class="lead">
			你也可以移步到<a href="/node-d2server/module.html">Module页面</a>了解更多D2Server特性。
		</p>

		<hr>
		<h5>一点点需要注意的事</h5>
		<ul>
			<li>
				D2Server的各个配置参数，除了定义<code>Domain</code> <code>hostname</code> <code>alias</code>这些与域名相关的路径时，不需要加结束的"/"，其他定义目录的配置参数，都需要以"\"结尾，<b>这个很重要</b>。
			</li>
			<li>
				D2Server内部机制是区分路径的大小写的，windows用户需要特别注意，不区分路径大小写，很可能造成文件修改之后，浏览器中刷新无变化等众多灵异状况。
			</li>
		</ul>
		<hr>
		<p>
			如果在配置环境时遇到了问题，欢迎向我们<a href="/node-d2server/feedback.html" target="_blank">反馈</a>。
		</p>
	</div>
	<!-- 结束语：end -->
</div>
<!-- Content End -->





</div>
</div>
<div class="eA">
	<p>
		Designed by <a href="http://twitter.com/mdo" target="_blank">@mdo</a> and <a href="http://twitter.com/fat" target="_blank">@fat</a>. Built by <a href="https://plus.google.com/102678188433989978435?rel=author" target="_blank">Bacra</a>.
	</p>
	<p>
		Code licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License v2.0</a>
		, documentation under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
	</p>
</div>
<script type="text/javascript" src="/common/google-code-prettify/run_prettify.js"></script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_r.js?move=0&amp;btn=r5.gif&amp;uid=1375936934454860" charset="utf-8"></script>
<script type="text/javascript" src="/common/bootstrap/bootstrap.js"></script>
<script type="text/javascript" src="/node-d2server/js/base.min.js"></script>
</body>
</html>